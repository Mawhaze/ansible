---
- name: Provision users and services
  become: true
  block:
  - name: Gather Facts
    setup:

  - name: Set up basic host information
    include_tasks: set_host_info.yml

  - name: Initial updates
    include_role:
      name: os_updates

  - name: Add Ubuntu users
    include_tasks: ubuntu_users.yml
    when: ansible_facts['distribution'] == "Ubuntu"

  - name: Configure Git
    include_tasks: git_setup.yml
    when: ansible_facts['distribution'] == "Ubuntu"

  - name: Configure Docker
    include_tasks: docker_setup.yml
    when: 
      - ansible_facts['distribution'] == "Ubuntu"
      - "'service_docker' in group_names"

- name: Cleanup
  include_tasks: cleanup.yml
  when: ansible_facts['distribution'] == "Ubuntu"