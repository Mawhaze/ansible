plugin: community.general.proxmox
url: "{{ lookup('aws_ssm', '/ansible/proxmox/cluster_url', region='us-west-2', decrypt='true') }}"
user: "{{ lookup('aws_ssm', '/ansible/sa-ansible/proxmox-user', region='us-west-2', decrypt='true') }}"
password: "{{ lookup('aws_ssm', '/ansible/sa-ansible/proxmox-password', region='us-west-2', decrypt='true') }}"
want_facts: true
want_proxmox_nodes_ansible_host: false
filters:
  - proxmox_status == "running"
compose:
  ansible_host: proxmox_agent_interfaces | selectattr('name', 'in', 'eth0,ens18') | map(attribute='ip-addresses') | flatten | first | ansible.util.ipaddr('address')
keyed_groups:
  - key: proxmox_tags_parsed
groups:
  os_ubuntu: "'ubuntu' in (proxmox_tags_parsed|list)"
  service_docker: "'docker' in (proxmox_tags_parsed|list)"
  service_jenkins: "'jenkins' in (proxmox_tags_parsed|list)"
  bootstrap_host: "'bootstrap' in (proxmox_tags_parsed|list)"